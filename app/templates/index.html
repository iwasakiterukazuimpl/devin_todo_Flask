{% extends 'base.html' %}

{% block title %}タスク一覧{% endblock %}

{% block content %}
    <section class="task-form">
        <h2>新しいタスクを追加</h2>
        <form action="{{ url_for('add') }}" method="post">
            <div class="form-group">
                <label for="title">タイトル</label>
                <input type="text" id="title" name="title" required>
            </div>
            <div class="form-group">
                <label for="description">説明</label>
                <textarea id="description" name="description"></textarea>
            </div>
            <div class="form-group">
                <label for="deadline">締切日</label>
                <input type="date" id="deadline" name="deadline">
            </div>
            <button type="submit">追加</button>
        </form>
    </section>

    <section class="task-list">
        <h2>タスク一覧</h2>
        {% if tasks %}
            <table class="task-table">
                <thead>
                    <tr>
                        <th>タイトル</th>
                        <th>締切日</th>
                        <th>状態</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in tasks %}
                        <tr class="{% if task.completed %}completed{% endif %}">
                            <td>{{ task.title }}</td>
                            <td>{{ task.deadline.strftime('%Y-%m-%d') if task.deadline else '未設定' }}</td>
                            <td>{{ '完了' if task.completed else '未完了' }}</td>
                            <td class="task-actions">
                                <form action="{{ url_for('update', id=task.id) }}" method="post">
                                    <input type="hidden" name="title" value="{{ task.title }}">
                                    <input type="hidden" name="description" value="{{ task.description or '' }}">
                                    <input type="hidden" name="deadline" value="{{ task.deadline.strftime('%Y-%m-%d') if task.deadline else '' }}">
                                    <input type="checkbox" name="completed" {% if task.completed %}checked{% endif %} onchange="this.form.submit()">
                                    <button type="button" class="edit-btn" onclick="editTask({{ task.id }})">編集</button>
                                </form>
                                <a href="{{ url_for('delete', id=task.id) }}" class="delete-btn">削除</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>タスクはまだありません。</p>
        {% endif %}
    </section>

    <script>
        function editTask(taskId) {
            // 編集機能は将来的に実装予定
            alert('編集機能は将来的に実装予定です。現在はチェックボックスで完了状態の切り替えのみ可能です。');
        }
    </script>
{% endblock %}
